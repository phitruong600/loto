<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Loto Pro | Quay Số May Mắn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Nunito', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            900: '#064e3b',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            /* Ngăn kéo trang trên mobile để tạo cảm giác giống App native */
            overscroll-behavior-y: none;
            touch-action: manipulation;
            background-color: #f3f4f6;
        }

        /* Hiệu ứng bóng 3D thực hơn */
        .loto-ball {
            background: radial-gradient(circle at 30% 30%, #ffffff, #e5e7eb, #9ca3af);
            box-shadow: 
                inset -5px -5px 15px rgba(0,0,0,0.15), 
                5px 10px 20px rgba(0,0,0,0.15),
                inset 5px 5px 10px rgba(255,255,255,0.8);
        }
        
        .loto-ball.active-spin {
             background: radial-gradient(circle at 30% 30%, #ecfdf5, #a7f3d0, #34d399);
             box-shadow: 
                inset -5px -5px 15px rgba(0,0,0,0.2), 
                0 0 20px rgba(52, 211, 153, 0.6);
        }

        /* Rung lắc mạnh hơn */
        @keyframes shake-hard {
            0% { transform: translate(0, 0) rotate(0); }
            10% { transform: translate(-3px, -3px) rotate(-5deg); }
            20% { transform: translate(3px, 2px) rotate(5deg); }
            30% { transform: translate(-4px, 2px) rotate(-5deg); }
            40% { transform: translate(4px, -3px) rotate(5deg); }
            50% { transform: translate(-3px, 3px) rotate(-5deg); }
            60% { transform: translate(3px, -2px) rotate(5deg); }
            70% { transform: translate(-4px, -3px) rotate(-5deg); }
            80% { transform: translate(2px, 3px) rotate(5deg); }
            90% { transform: translate(-2px, -2px) rotate(-5deg); }
            100% { transform: translate(0, 0) rotate(0); }
        }
        .shaking {
            animation: shake-hard 0.3s infinite linear;
        }

        @keyframes pop-scale {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: pop-scale 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        /* Grid Responsive thông minh */
        .grid-responsive {
            display: grid;
            gap: 4px;
            /* Mobile Portrait: 5 cột */
            grid-template-columns: repeat(5, 1fr); 
        }
        
        /* Mobile Landscape & Tablet: 10 cột */
        @media (min-width: 640px) {
            .grid-responsive {
                grid-template-columns: repeat(10, 1fr);
                gap: 6px;
            }
        }

        /* Custom Scrollbar cho đẹp */
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
            height: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        /* Landscape Mobile Tweaks (Chiều cao thấp) */
        @media (orientation: landscape) and (max-height: 500px) {
            .landscape-hide { display: none !important; }
            .landscape-compact-ball { width: 5rem !important; height: 5rem !important; }
            .landscape-compact-text { font-size: 2.5rem !important; }
            .landscape-flex-row { flex-direction: row !important; }
            .landscape-col-span-1 { grid-column: span 1 / span 1 !important; }
            .landscape-h-full { height: 100vh !important; overflow: hidden; padding-bottom: 0 !important; }
            .landscape-scroll-area { height: calc(100vh - 20px) !important; overflow-y: auto; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 h-screen overflow-hidden flex flex-col">

    <!-- Thanh Topbar (Nhỏ gọn) -->
    <div class="bg-white shadow-sm z-20 flex-none px-4 py-2 flex justify-between items-center landscape-hide">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white font-bold text-xl shadow-lg">L</div>
            <h1 class="font-black text-xl text-gray-800 tracking-tight">LOTO <span class="text-brand-600">PRO</span></h1>
        </div>
        <div class="text-xs text-gray-500 font-semibold bg-gray-100 px-2 py-1 rounded-md">
            1-90
        </div>
    </div>

    <!-- Main Container -->
    <div class="flex-1 overflow-hidden relative w-full max-w-7xl mx-auto p-2 md:p-4">
        
        <!-- Layout Grid: Mobile Landscape sẽ chia đôi màn hình -->
        <div class="grid grid-cols-1 md:grid-cols-12 gap-4 h-full">
            
            <!-- CỘT TRÁI: ĐIỀU KHIỂN & BÓNG SỐ -->
            <!-- Trên Desktop chiếm 4 phần, Mobile Landscape chiếm 5 phần -->
            <div class="md:col-span-4 lg:col-span-3 flex flex-col gap-3 h-full overflow-y-auto custom-scroll pb-20 md:pb-0 landscape-scroll-area">
                
                <!-- Card Chính: Bóng Số -->
                <div class="bg-white rounded-2xl shadow-lg p-4 flex flex-col items-center justify-center relative border border-gray-100 overflow-hidden shrink-0">
                    <!-- Background trang trí -->
                    <div class="absolute top-0 w-full h-1 bg-gradient-to-r from-brand-400 to-blue-500"></div>
                    <div class="absolute -right-6 -top-6 w-24 h-24 bg-brand-50 rounded-full opacity-50 z-0"></div>

                    <!-- Thống kê nhỏ -->
                    <div class="w-full flex justify-between text-xs font-bold text-gray-400 mb-2 z-10">
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-brand-500"></span> Đã gọi: <span id="countCalled" class="text-gray-800 text-sm">0</span></span>
                        <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full bg-red-400"></span> Còn lại: <span id="countRemaining" class="text-gray-800 text-sm">90</span></span>
                    </div>

                    <!-- Quả Bóng (Responsive size) -->
                    <div id="currentBall" class="loto-ball w-32 h-32 md:w-44 md:h-44 landscape-compact-ball rounded-full flex items-center justify-center mb-3 cursor-pointer transform transition-transform hover:scale-105 active:scale-95 z-10" onclick="drawNumber()">
                        <span id="displayNumber" class="text-6xl md:text-8xl landscape-compact-text font-black text-gray-700 tracking-tighter transition-colors">--</span>
                    </div>
                    
                    <!-- Trạng thái -->
                    <div id="statusText" class="h-5 text-sm font-bold text-brand-600 mb-2 z-10">Sẵn sàng!</div>

                    <!-- Nút Quay -->
                    <button id="btnDraw" onclick="drawNumber()" class="w-full bg-brand-600 hover:bg-brand-700 active:bg-brand-800 text-white text-lg font-bold py-3 md:py-4 rounded-xl shadow-lg shadow-brand-200 transform transition-all active:translate-y-0.5 z-10 flex items-center justify-center gap-2 group">
                        <span>QUAY SỐ</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:rotate-180 transition-transform duration-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </button>
                </div>

                <!-- Card Phụ: Cài đặt (Auto & Voice) -->
                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-3 shrink-0">
                    <div class="flex flex-col gap-3">
                        <!-- Auto Play Row -->
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <div class="p-1.5 bg-blue-50 text-blue-600 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </div>
                                <span class="text-sm font-bold text-gray-700">Tự động</span>
                            </div>
                            <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-1">
                                <select id="autoSpeed" class="bg-transparent text-xs font-semibold text-gray-600 outline-none">
                                    <option value="3000">3s</option>
                                    <option value="4000" selected>4s</option>
                                    <option value="5000">5s</option>
                                </select>
                                <button id="btnAutoToggle" onclick="toggleAutoMode()" class="bg-white shadow text-gray-500 hover:text-brand-600 px-3 py-1 rounded-md text-xs font-bold transition-colors">
                                    BẬT
                                </button>
                            </div>
                        </div>

                        <!-- Voice Row -->
                        <div class="flex items-center justify-between border-t border-gray-100 pt-2">
                             <div class="flex items-center gap-2">
                                <div class="p-1.5 bg-purple-50 text-purple-600 rounded-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                                </div>
                                <span class="text-sm font-bold text-gray-700">Giọng</span>
                            </div>
                            <div class="flex-1 ml-3">
                                <select id="voiceSelect" onchange="testVoice()" class="w-full bg-gray-50 border-none text-xs rounded py-1 px-2 text-gray-600 outline-none truncate">
                                    <option value="">Mặc định</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nút Reset -->
                <button onclick="resetGame()" class="w-full py-2 text-gray-400 hover:text-gray-600 text-xs font-bold uppercase tracking-wider transition-colors shrink-0">
                    Làm mới game
                </button>
            </div>

            <!-- CỘT PHẢI: BẢNG DÒ SỐ -->
            <!-- Chiếm không gian còn lại -->
            <div class="md:col-span-8 lg:col-span-9 h-full overflow-hidden flex flex-col bg-white rounded-2xl shadow-lg border border-gray-100">
                
                <!-- Header Bảng -->
                <div class="px-4 py-3 border-b border-gray-100 flex justify-between items-center bg-gray-50 flex-none">
                    <h2 class="font-bold text-gray-800 text-sm md:text-base flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                        BẢNG DÒ SỐ
                    </h2>
                    <div class="flex gap-3 text-xs font-semibold">
                        <div class="flex items-center gap-1.5 text-gray-500"><div class="w-2.5 h-2.5 rounded-sm bg-gray-100 border border-gray-300"></div> Chưa</div>
                        <div class="flex items-center gap-1.5 text-brand-600"><div class="w-2.5 h-2.5 rounded-sm bg-brand-500 shadow-sm"></div> Đã ra</div>
                    </div>
                </div>

                <!-- Lịch sử gần nhất (Sticky top bên trong bảng) -->
                <div class="bg-white px-4 py-2 border-b border-gray-100 flex-none z-10 shadow-sm">
                    <div id="recentHistory" class="flex items-center gap-2 overflow-x-auto no-scrollbar h-10 scroll-smooth">
                        <span class="text-xs text-gray-400 italic pl-1">Lịch sử sẽ hiện ở đây...</span>
                    </div>
                </div>

                <!-- Vùng chứa Grid (Scrollable) -->
                <div class="flex-1 overflow-y-auto p-2 md:p-4 custom-scroll relative">
                     <div id="boardGrid" class="grid-responsive select-none">
                        <!-- JS Render -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // === CẤU HÌNH & TRẠNG THÁI ===
        const TOTAL_NUMBERS = 90;
        let availableNumbers = [];
        let drawnNumbers = [];
        let isAnimating = false;
        
        let autoIntervalId = null;
        let isAutoPlaying = false;
        let voices = [];
        const synth = window.speechSynthesis;

        // === KHỞI TẠO ===
        window.onload = function() {
            initGame();
            initVoices();
            setupKeyboard();
        };

        // Keyboard Event
        function setupKeyboard() {
            document.addEventListener('keydown', (e) => {
                if(e.code === 'Space') e.preventDefault();
                if(isAutoPlaying) return;
                if((e.code === 'Space' || e.code === 'ArrowRight') && !isAnimating && availableNumbers.length > 0) {
                    drawNumber();
                }
            });
        }

        // Voice Setup
        function initVoices() {
            if (synth.onvoiceschanged !== undefined) synth.onvoiceschanged = populateVoiceList;
            populateVoiceList();
        }

        function populateVoiceList() {
            voices = synth.getVoices();
            const select = document.getElementById('voiceSelect');
            select.innerHTML = '<option value="">Mặc định</option>';
            
            const vnVoices = voices.filter(v => v.lang.includes('vi'));
            vnVoices.forEach((v) => {
                const opt = document.createElement('option');
                opt.textContent = `${v.name.slice(0, 15)}.. (VN)`;
                opt.value = voices.indexOf(v);
                select.appendChild(opt);
            });
            
            if(vnVoices.length === 0 && voices.length > 0) {
                // Thêm một số giọng mẫu khác nếu không có tiếng Việt
                const fallback = voices.filter(v => v.lang.includes('en')).slice(0, 2);
                 fallback.forEach((v) => {
                    const opt = document.createElement('option');
                    opt.textContent = `${v.name.slice(0, 15)}.. (EN)`;
                    opt.value = voices.indexOf(v);
                    select.appendChild(opt);
                });
            }
        }

        function speak(text) {
            if (synth.speaking) synth.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            const voiceIdx = document.getElementById('voiceSelect').value;
            
            if (voiceIdx !== "") {
                utterance.voice = voices[voiceIdx];
            } else {
                const vn = voices.find(v => v.lang.includes('vi'));
                if(vn) utterance.voice = vn;
            }
            utterance.rate = 1;
            synth.speak(utterance);
        }
        
        function testVoice() {
            speak("Một Hai Ba");
        }

        // === GAME LOGIC ===
        function initGame() {
            stopAutoMode();
            availableNumbers = Array.from({length: TOTAL_NUMBERS}, (_, i) => i + 1);
            drawnNumbers = [];
            
            // Reset UI
            const ball = document.getElementById('currentBall');
            const display = document.getElementById('displayNumber');
            
            display.innerText = "--";
            display.className = "text-6xl md:text-8xl landscape-compact-text font-black text-gray-300 tracking-tighter transition-colors";
            ball.className = "loto-ball w-32 h-32 md:w-44 md:h-44 landscape-compact-ball rounded-full flex items-center justify-center mb-3 cursor-pointer transform transition-transform hover:scale-105 active:scale-95 z-10";
            
            document.getElementById('statusText').innerText = "Sẵn sàng!";
            const btn = document.getElementById('btnDraw');
            btn.disabled = false;
            btn.className = "w-full bg-brand-600 hover:bg-brand-700 active:bg-brand-800 text-white text-lg font-bold py-3 md:py-4 rounded-xl shadow-lg shadow-brand-200 transform transition-all active:translate-y-0.5 z-10 flex items-center justify-center gap-2 group";
            btn.innerHTML = `<span>QUAY SỐ</span><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:rotate-180 transition-transform duration-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>`;

            updateStats();
            renderBoard();
            renderHistory();
        }

        function renderBoard() {
            const grid = document.getElementById('boardGrid');
            grid.innerHTML = '';
            for(let i=1; i<=TOTAL_NUMBERS; i++) {
                const el = document.createElement('div');
                const isDrawn = drawnNumbers.includes(i);
                
                // Style cho ô số
                let baseClass = "flex items-center justify-center h-8 md:h-10 rounded-lg text-sm md:text-base font-bold transition-all duration-300 border ";
                if(isDrawn) {
                    baseClass += "bg-brand-500 text-white border-brand-600 shadow-md transform scale-105 shadow-brand-200";
                } else {
                    baseClass += "bg-gray-50 text-gray-300 border-gray-100";
                }
                
                el.className = baseClass;
                el.innerText = i;
                el.id = `cell-${i}`;
                grid.appendChild(el);
            }
        }

        function renderHistory() {
            const container = document.getElementById('recentHistory');
            container.innerHTML = '';
            if(drawnNumbers.length === 0) {
                container.innerHTML = '<span class="text-xs text-gray-400 italic pl-1">Lịch sử...</span>';
                return;
            }

            // Hiện tất cả lịch sử, cuộn ngang, mới nhất bên TRÁI
            [...drawnNumbers].reverse().forEach((num, idx) => {
                const badge = document.createElement('div');
                badge.className = `flex-none flex items-center justify-center rounded-full font-bold text-xs shadow-sm border ${idx === 0 ? 'w-8 h-8 bg-brand-500 text-white border-brand-300 animate-pop' : 'w-7 h-7 bg-white text-gray-500 border-gray-200'}`;
                badge.innerText = num;
                container.appendChild(badge);
            });
        }

        function updateStats() {
            document.getElementById('countCalled').innerText = drawnNumbers.length;
            document.getElementById('countRemaining').innerText = availableNumbers.length;
        }

        // === ACTION ===
        function drawNumber() {
            if (isAnimating) return;
            if (availableNumbers.length === 0) {
                document.getElementById('statusText').innerText = "Đã hết số!";
                stopAutoMode();
                return;
            }

            isAnimating = true;
            const display = document.getElementById('displayNumber');
            const ball = document.getElementById('currentBall');
            const btn = document.getElementById('btnDraw');

            // Hiệu ứng bắt đầu
            ball.classList.add('shaking', 'active-spin');
            display.className = "text-6xl md:text-8xl landscape-compact-text font-black text-brand-600 tracking-tighter opacity-80 blur-[1px]"; // Làm mờ nhẹ khi quay
            document.getElementById('statusText').innerText = "Đang quay...";
            
            let count = 0;
            const interval = setInterval(() => {
                display.innerText = Math.floor(Math.random() * 90) + 1;
                count++;
            }, 60);

            // Kết thúc sau 1s
            setTimeout(() => {
                clearInterval(interval);
                
                // Logic chọn số
                const idx = Math.floor(Math.random() * availableNumbers.length);
                const num = availableNumbers[idx];
                availableNumbers.splice(idx, 1);
                drawnNumbers.push(num);

                // Update UI
                ball.classList.remove('shaking', 'active-spin');
                display.innerText = num;
                display.className = "text-6xl md:text-8xl landscape-compact-text font-black text-brand-600 tracking-tighter transition-all animate-pop"; // Màu xanh đậm
                document.getElementById('statusText').innerText = `Số: ${num}`;
                
                // Update Bảng & Lịch sử
                const cell = document.getElementById(`cell-${num}`);
                if(cell) {
                    cell.className = "flex items-center justify-center h-8 md:h-10 rounded-lg text-sm md:text-base font-bold transition-all duration-300 border bg-brand-500 text-white border-brand-600 shadow-md transform scale-110 shadow-brand-200 z-10";
                }
                
                renderHistory();
                updateStats();
                speak(`Số ${num}`);

                isAnimating = false;

                // Check hết số
                if(availableNumbers.length === 0) {
                    document.getElementById('statusText').innerText = "HẾT SỐ!";
                    btn.disabled = true;
                    btn.className = "w-full bg-gray-400 text-white text-lg font-bold py-3 md:py-4 rounded-xl shadow-none cursor-not-allowed flex items-center justify-center gap-2";
                    btn.innerText = "HẾT SỐ";
                    stopAutoMode();
                }

            }, 1000);
        }

        // === AUTO MODE ===
        function toggleAutoMode() {
            const btn = document.getElementById('btnAutoToggle');
            const speed = parseInt(document.getElementById('autoSpeed').value);
            
            if(isAutoPlaying) {
                stopAutoMode();
            } else {
                if(availableNumbers.length === 0) return alert("Hết số!");
                isAutoPlaying = true;
                
                // UI Button Style Change
                btn.innerText = "DỪNG";
                btn.className = "bg-red-50 shadow text-red-500 hover:text-red-600 px-3 py-1 rounded-md text-xs font-bold transition-colors border border-red-100 animate-pulse";
                document.getElementById('btnDraw').disabled = true;
                document.getElementById('btnDraw').classList.add('opacity-70', 'cursor-wait');

                drawNumber();
                autoIntervalId = setInterval(() => {
                    if(!isAnimating && availableNumbers.length > 0) {
                        drawNumber();
                    } else if (availableNumbers.length === 0) {
                        stopAutoMode();
                    }
                }, speed + 1200);
            }
        }

        function stopAutoMode() {
            isAutoPlaying = false;
            if(autoIntervalId) clearInterval(autoIntervalId);
            autoIntervalId = null;
            
            const btn = document.getElementById('btnAutoToggle');
            btn.innerText = "BẬT";
            btn.className = "bg-white shadow text-gray-500 hover:text-brand-600 px-3 py-1 rounded-md text-xs font-bold transition-colors";
            
            if(!isAnimating && availableNumbers.length > 0) {
                const drawBtn = document.getElementById('btnDraw');
                drawBtn.disabled = false;
                drawBtn.classList.remove('opacity-70', 'cursor-wait');
            }
        }
        
        function resetGame() {
            if(drawnNumbers.length === 0 || confirm("Chơi ván mới nhé?")) {
                initGame();
            }
        }
    </script>
</body>
</html>
